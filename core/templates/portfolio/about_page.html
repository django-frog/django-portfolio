{% extends "portfolio/core/base.html" %}
{% load static %}
{% load i18n %}

{% block content %}
<meta name="csrf-token" content="{{ csrf_token }}">

<div class="flex flex-col justify-center items-center p-12 md:h-full min-h-screen gap-6 bg-gray-50 dark:bg-gray-900">

    <div>
        <h1 class="text-3xl md:text-5xl text-green-600 dark:text-green-500 font-bold uppercase">{% trans "About me" %}</h1>
    </div>


    <!-- CHATBOT COMPONENT -->
    <div x-data="chatbot()" class="w-full max-w-4xl mx-auto px-4 mt-6">

        <!-- Collapsed State -->
        <div 
            @click="open = true"
            x-show="!open"
            x-cloak
            class="flex items-center justify-between p-4 rounded-2xl shadow bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 cursor-pointer"
        >
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl flex items-center justify-center bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300">
                    ü§ñ
                </div>
                <div>
                    <p class="font-semibold text-sm text-gray-800 dark:text-gray-100">Ask Me Anything</p>
                    <p class="text-xs text-gray-500 dark:text-gray-300">Tap to open chat</p>
                </div>
            </div>

            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/>
            </svg>
        </div>

        <!-- Open Chat Window -->
        <div 
            x-show="open"
            x-cloak
            x-transition:enter="transition duration-200 ease-out"
            x-transition:enter-start="opacity-0 translate-y-4"
            x-transition:enter-end="opacity-100 translate-y-0"
            x-transition:leave="transition duration-150 ease-in"
            x-transition:leave-start="opacity-100 translate-y-0"
            x-transition:leave-end="opacity-0 translate-y-4"
            class="fixed bottom-0 left-0 right-0 md:static md:mt-4 z-50"
        >
            <div class="mx-4 md:mx-0 md:rounded-2xl bg-white dark:bg-gray-800 shadow-xl border border-gray-200 dark:border-gray-700 md:max-w-4xl md:mb-6">

                <!-- Header -->
                <div class="flex justify-between items-center px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300">
                            ü§ñ
                        </div>
                        <div>
                            <p class="font-semibold text-sm text-gray-800 dark:text-gray-100">Chat with AI</p>
                            <p class="text-xs text-gray-500 dark:text-gray-300">Ask anything about me</p>
                        </div>
                    </div>
                    <button @click="open = false" class="p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>

                <!-- Messages -->
                <div id="chat-scroll" class="h-[60vh] md:h-80 overflow-y-auto p-4 space-y-3" x-ref="container">

                    <template x-for="(m, i) in messages" :key="i">
                        <div class="flex" :class="m.sender === 'user' ? 'justify-end' : 'justify-start'">
                            <div
                                class="max-w-[75%] px-4 py-2 rounded-2xl text-sm leading-relaxed"
                                :class="m.sender === 'user'
                                    ? 'bg-green-600 text-white rounded-br-none'
                                    : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-bl-none'"
                                x-text="m.text"
                            ></div>
                        </div>
                    </template>

                    <!-- Typing -->
                    <div x-show="loading" class="flex justify-start">
                        <div class="px-4 py-2 rounded-2xl bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-300 text-sm">
                            ...
                        </div>
                    </div>
                </div>

                <!-- Input -->
                <form @submit.prevent="sendMessage" class="border-t border-gray-200 dark:border-gray-700 p-4 flex gap-2">
                    <input 
                        type="text"
                        x-model="userMessage"
                        placeholder="Type your question..."
                        class="flex-1 px-3 py-2 rounded-xl bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 outline-none text-sm"
                    >
                    <button class="px-4 py-2 rounded-xl bg-green-600 hover:bg-green-700 text-white text-sm" :disabled="loading">
                        Send
                    </button>
                </form>
            </div>
        </div>

    </div>



    <div class="text-center justify-items-start">
        <p class="text-sm dark:text-gray-50 text-gray-500 italic font-thin my-4">{% trans "(In Short)" %}</p>
        <p class="text-2xl font-sans dark:text-gray-50 text-black font-extrabold">I <span class="text-red-500 font-bold">‚ù§Ô∏è</span> Django</p>
    </div>

    <div class="text-center">
        <ul class="list-none grid grid-cols-1 md:grid-cols-3 md:space-x-6 text-gray-500 gap-12 md:gap-6 dark:text-gray-50 text-lg">
            <!-- Biography Section -->
            <li class="list-item p-6 rounded-lg shadow-md hover:shadow-lg transition duration-300 hover:scale-105 transform hover:bg-green-50 dark:bg-gray-800 dark:hover:bg-green-900">
                <h2 class="font-mono font-bold text-green-500">{% trans "Biography" %} üëè</h2>
                <p class="font-sans font-light text-sm md:text-lg mt-4">
                    {% blocktrans %}Passionate and detail-oriented Django Developer with over 5 years of experience in building robust and scalable web applications.{% endblocktrans %}
                    
                </p>
            </li>
    
            <!-- Education Section -->
            <li class="list-item p-6 rounded-lg shadow-md hover:shadow-lg transition duration-300 hover:scale-105 transform hover:bg-green-50 dark:bg-gray-800 dark:hover:bg-green-900">
                <h2 class="font-mono font-bold text-green-500">{% trans "Education" %} üìö</h2>
                <p class="font-sans font-light text-sm md:text-lg mt-4">
                    {% blocktrans %}Bachelor in Computer Science, I focused on courses like Web Development, Database Systems, and Algorithms. I was also an active member of the Coding Club and participated in several hackathons, which helped me sharpen my problem-solving and teamwork skills.{% endblocktrans %}
                </p>
            </li>
    
            <!-- Skills Section -->
            <li class="list-item p-6 rounded-lg shadow-md hover:shadow-lg transition duration-300 hover:scale-105 transform hover:bg-green-50 dark:bg-gray-800 dark:hover:bg-green-900">
                <h2 class="font-mono font-bold text-green-500">{% trans "Skills" %} üßó‚Äç‚ôÇÔ∏è</h2>
                <ul class="font-sans font-light text-sm md:text-lg list mt-4 space-y-2">
                    <li>Django, Django REST Framework</li>
                    <li>PostgreSQL, MySQL</li>
                    <li>RESTful APIs, Third-Party Integrations</li>
                    <li>Docker, AWS Basics</li>
                    <li>Redis, Celery</li>
                    <li>Git, GitHub</li>
                    <li>HTML, CSS, JavaScript</li>
                    <li>Problem-Solving, Team Collaboration</li>
                </ul>
            </li>
        </ul>
    </div>    
</div>

<script>
document.addEventListener("alpine:init", () => {
    Alpine.data("chatbot", () => ({
        open: false,
        userMessage: "",
        messages: [],
        loading: false,

        init() {
            // Load saved history
            const saved = localStorage.getItem("chat_messages");
            try {
                this.messages = saved ? JSON.parse(saved) : [];
            } catch (e) {
                console.error("Corrupted chat history, resetting.");
                localStorage.removeItem("chat_messages");
                this.messages = [];
            }

            // Auto-scroll after loading
            this.$nextTick(() => {
                const box = document.querySelector("#chat-scroll");
                if (box) box.scrollTop = box.scrollHeight;
            });
        },

        saveMessages() {
            localStorage.setItem("chat_messages", JSON.stringify(this.messages));
        },

        async sendMessage() {
            const question = this.userMessage.trim();
            if (!question || this.loading) return;

            // Add user message
            this.messages.push({
                sender: "user",
                text: question,
            });
            this.saveMessages();

            this.userMessage = "";
            this.loading = true;

            const csrftoken = document.querySelector('meta[name="csrf-token"]').content;

            try {
                const response = await fetch("/home/api/ai-chat/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrftoken,
                        "X-Requested-With": "XMLHttpRequest",
                    },
                    body: JSON.stringify({ question }),
                });

                const data = await response.json();

                this.messages.push({
                    sender: "bot",
                    text: response.ok
                        ? data.reply
                        : ("‚ùå " + (data.message || data.error || "Something went wrong")),
                });

            } catch (e) {
                this.messages.push({
                    sender: "bot",
                    text: "‚ùå Network error. Please try again.",
                });
            }

            this.saveMessages(); // Save after bot reply
            this.loading = false;

            this.$nextTick(() => {
                const box = document.querySelector("#chat-scroll");
                if (box) box.scrollTop = box.scrollHeight;
            });
        },
    }));
});
</script>


{% endblock content %}

{% block title %}
    Django Dev | About Me
{% endblock title %}
